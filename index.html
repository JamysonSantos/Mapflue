<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mapflue com Rete.js</title>
  <style>
    html, body {
      margin: 0;
      height: 100%;
      font-family: sans-serif;
    }
    #rete {
      width: 100vw;
      height: 100vh;
    }
    .node .title {
      font-size: 14px;
      font-weight: bold;
      padding: 4px;
      color: #fff;
      text-align: center;
      border-radius: 4px 4px 0 0;
    }
    .node .content {
      padding: 10px;
      background: #f4f4f4;
      font-size: 13px;
      min-height: 40px;
    }
  </style>

  <!-- Rete.js & Plugins -->
  <script src="https://cdn.jsdelivr.net/npm/rete@1.4.4/build/rete.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/rete-connection-plugin@0.9.0/build/connection-plugin.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/rete-render-plugin@0.2.1/build/render-plugin.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/rete-context-menu-plugin@0.6.4/build/context-menu-plugin.min.js"></script>
</head>
<body>
  <div id="rete"></div>
  <script>
    async function createEditor() {
      const container = document.getElementById("rete");
      const components = [];

      const editor = new Rete.NodeEditor("mapflue@0.1.0", container);
      editor.use(ConnectionPlugin.default);
      editor.use(RenderPlugin.default);
      editor.use(ContextMenuPlugin.default);

      const engine = new Rete.Engine("mapflue@0.1.0");

      // Socket comum para todos os nós
      const socket = new Rete.Socket("Socket padrão");

      // Componente de nó
      class TaskComponent extends Rete.Component {
        constructor() {
          super("Tarefa");
        }

        builder(node) {
          const inp = new Rete.Input("in", "Entrada", socket);
          const out = new Rete.Output("out", "Saída", socket);

          node.addInput(inp);
          node.addOutput(out);
          node.meta = {
            style: node.data.color || "#2196f3"
          };

          const html = `
            <div class="title" style="background:${node.meta.style}">${node.data.label || "Nova Tarefa"}</div>
            <div class="content">${node.data.desc || "Descrição da tarefa aqui..."}</div>
          `;

          node.html = html;

          return node;
        }

        worker(node, inputs, outputs) {}
      }

      const taskComponent = new TaskComponent();
      editor.register(taskComponent);
      engine.register(taskComponent);

      // Adiciona um nó ao editor
      async function addNode(type = "task", label = "Nova Tarefa", desc = "Descrição", color = "#2196f3", x = 100, y = 100) {
        const node = await taskComponent.createNode({ label, desc, color });
        node.position = [x, y];
        editor.addNode(node);
      }

      // Exemplo inicial: Início, Tarefa, Fim
      await addNode("start", "Início", "Início do processo", "#4caf50", 100, 200);
      await addNode("task", "Verificar Pedido", "Financeiro", "#2196f3", 350, 200);
      await addNode("end", "Fim", "Finalizar processo", "#f44336", 600, 200);

      editor.on("rendernode", ({ el, node, component }) => {
        if (node.html) {
          el.innerHTML = node.html;
        }
      });

      editor.view.resize();
      editor.trigger("process");
    }

    createEditor();
  </script>
</body>
</html>


















